<div class="draft">
  <div class="row">
    <h3 class="center">
      <span>Draft: <%= @draft.id %></span>
      <span><%= @draft.season %> <%= @draft.year %></span>
    </h3>
    <h4 class="center">
      <% if !@draft.active? %>
        <span class="red">The draft has not started yet</span>
      <% elsif @draft.my_turn?(current_user) %>
        <span class="captains-turn">Captain's Turn: <%= @draft.captains_turn %></span>
      <% else %>
        <span>Captain's Turn: <%= @draft.captains_turn %></span>
      <% end %>
      <span>Round: <%= @draft.round %></span>
    </h4>
    <% if @draft.active? %>
      <h5 class="center check" data-id="<%= @draft.id %>" data-turn="<%= @draft.turn %>">
        Auto-refresh? <%= check_box_tag("accept") %>
      </h5>
    <% end %>
  </div>
  <hr>
  <div class="row-fluid center">
    <div class="span6 group left">
      <h4>Drafted Players</h4>
      <div class="row-fluid">
        <h5 class="span3">Player</h5>
        <h5 class="span2">Round</h5>
        <h5 class="span3">Phone Number</h5>
        <h5 class="span4">Email</h5>
      </div>
      <div class="row-fluid">
        <% if current_user.captains_team.drafted_players.empty? %>
          <div>There are no players yet!</div>
          <br>
        <% else %>
          <% current_user.captains_team.drafted_players.each do |dp| %>
            <div class="row-fluid">
              <div class="span3"><%= dp.player.name %></div>
              <div class="span2"><%= dp.round %></div>
              <div class="span3"><%= dp.player.phone_number %></div>
              <div class="span4"><%= dp.player.email %></div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <div id="add" class="span6 group right">
      <h4>Add Group</h4>
      <%= simple_form_for(@group, :html => { :class => "max-width" } ) do |f| %>
        <div class="row-fluid center">
          <%= f.input :name, :label => false, :input_html => { :class => "normal" } %>
          <%= f.hidden_field :draft_id %>
          <%= f.hidden_field :captain_id %>
        </div>
        <div class="row-fluid">
          <h5 class="span3">Player</h5>
          <h5 class="span3">Position</h5>
          <h5 class="span3">Rating</h5>
          <h5 class="span3">Info</h5>
        </div>
        <%= f.simple_fields_for :draft_players do |player| %>
          <div class="row-fluid add-here">
            <div class="span3"><%= player.input :player_id, :label => false, :as => :select, :collection => @users %></div>
            <div class="span3"><%= player.input :position, :label => false %></div>
            <div class="span3"><%= player.input :rating, :label => false %></div>
            <div class="span3"><%= player.input :info, :label => false %></div>
          </div>
        <% end %>
        <div class="row-fluid center">
          <%= link_to "+", "#",
            :class => "btn btn-success add-player normal" %>
          <%= f.button :submit, "Update", :class => "btn btn-primary normal" %>
        </div>
      <% end %>
    </div>
    <% @groups.each_with_index do |group, index| %>
      <%= '<div class="row-fluid center">'.html_safe if index.even? %>
      <div id="readonly<%= group.id %>" class="span6 group <%= index.even? ? "left" : "right" %> readonly">
        <h4><%= "#{group.name}" %></h4>
        <div class="row-fluid">
          <h5 class="span3">Player</h5>
          <h5 class="span2">Position</h5>
          <h5 class="span2">Rating</h5>
          <h5 class="span2">Info</h5>
          <h5 class="span3"></h5>
        </div>
        <div class="row-fluid">
          <% if group.draft_players.empty? %>
            <div>There are no players yet!</div>
            <br>
          <% else %>
            <% group.draft_players.each do |dp| %>
              <div class="row-fluid">
                <div class="span3"><%= dp.player.name %></div>
                <div class="span2"><%= dp.position %></div>
                <div class="span2"><%= dp.rating %></div>
                <div class="span2"><%= dp.info %></div>
                <div class="span3 pull-right">
                  <% if dp.player.drafted?(@draft.id)%>
                    <%= link_to "Drafted", "#", :class => "btn normal" %>
                  <% else %>
                    <%= link_to "Draft",
                      drafted_player_path(dp.id),
                      :method => :put,
                      :class => "btn btn-primary normal" %>
                  <% end %>
                  <%= link_to "x",
                    draft_player_path(dp.id),
                    :method => :delete,
                    :data => { :confirm => "Are you sure you want to remove this player from this draft group?" },
                    :class => "btn btn-danger" %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
        <div class="row-fluid center">
          <%= link_to "Edit", "#",
            :data => { :id => group.id, :type => "readonly", :not => "editable" },
            :class => "btn btn-primary normal" %>
          <%= link_to "Delete", draft_group_path(group.id),
            :method => :delete,
            :data => { :confirm => "Are you sure you want to delete this draft group?" },
            :class => "btn btn-danger normal" %>
        </div>
      </div>
    <% end %>
    <div>
    <% @groups.each_with_index do |group, index| %>
      <% group.draft_players.build %>
      <div id="editable<%= group.id %>" class="span6 group <%= index.even? ? "left" : "right" %> editable hide">
        <%= simple_form_for(group, :html => { :class => "max-width" } ) do |f| %>
          <div class="row-fluid center">
            <h5>Name:</h5>
            <%= f.input :name, :label => false, :input_html => { :class => "normal" } %>
            <%= f.hidden_field :draft_id %>
            <%= f.hidden_field :captain_id %>
          </div>
          <div class="row-fluid">
            <h5 class="span3">Player</h5>
            <h5 class="span3">Position</h5>
            <h5 class="span3">Rating</h5>
            <h5 class="span3">Info</h5>
          </div>
          <%= f.simple_fields_for :draft_players do |player| %>
            <div class="row-fluid add-here">
              <div class="span3"><%= player.input :player_id, :label => false, :as => :select, :collection => @users %></div>
              <div class="span3"><%= player.input :position, :label => false %></div>
              <div class="span3"><%= player.input :rating, :label => false %></div>
              <div class="span3"><%= player.input :info, :label => false %></div>
            </div>
          <% end %>
          <div class="row-fluid center">
            <%= link_to "Show", "#",
              :data => { :id => group.id, :type => "readonly", :not => "editable" },
              :class => "btn btn-primary normal" %>
            <%= link_to "+", "#",
              :data => { :id => group.id },
              :class => "btn btn-success add-player normal" %>
            <%= f.button :submit, "Update", :class => "btn btn-primary normal" %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
